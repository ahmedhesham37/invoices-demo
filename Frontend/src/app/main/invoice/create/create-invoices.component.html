<div id="forms" class="page-layout simple fullwidth" fxLayout="column">
    <!-- HEADER -->
    <div
        class="header accent p-24 h-160"
        fxLayout="row"
        fxLayoutAlign="start center"
    >
        <div fxLayout="column" fxLayoutAlign="center start">
            <div fxLayout="row" fxLayoutAlign="start center">
                <mat-icon class="secondary-text s-18">home</mat-icon>
                <mat-icon class="secondary-text s-16">chevron_right</mat-icon>
                <span class="secondary-text">Invoices</span>
            </div>
            <div class="h1 mt-16">Create an Invoice</div>
        </div>
    </div>
    <!-- / HEADER -->
    <div class="content-card">

        <!-- CONTENT -->
        <div class="content p-24">
            <div class="horizontal-stepper-wrapper">
                <mat-horizontal-stepper class="mat-elevation-z4" [linear]="true">
                    <mat-step [stepControl]="projectsForm">
                        <form fxLayout="column" [formGroup]="projectsForm">
                            <ng-template matStepLabel>Project</ng-template>

                            <div class="tab-content p-24">
                                <mat-form-field appearance="outline" fxFlex="1 1">
                                    <mat-label>Project Name</mat-label>
                                    <mat-select
                                        formControlName="project"
                                        (valueChange)="populateProjectDetails($event)"
                                    >
                                        <mat-option
                                            *ngFor="let project of savedProjects"
                                            [value]="project.projectName"
                                        >{{ project.projectName }}
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="secondary-text"
                                    >outlined_flag
                                    </mat-icon>
                                    <mat-error>Project is required!</mat-error>
                                </mat-form-field>

                            </div>

                            <div
                                class="tab-content p-24"
                                fxFlex="1 0 auto"
                                fxLayout="column"
                                *ngIf="showProjectsForm"
                            >
                                <!--                                CLIENT DATA-->
                                <div class="section pb-48">
                                    <div
                                        class="pb-16"
                                        fxLayout="row"
                                        fxLayoutAlign="start center"
                                    >
                                        <mat-icon
                                            class="m-0 mr-16 secondary-text"
                                        >
                                            account_circle
                                        </mat-icon>
                                        <div class="h2 secondary-text">
                                            Client
                                        </div>
                                    </div>

                                    <div class="client mb-32">
                                        <table class="simple">
                                            <thead>
                                            <tr>
                                                <th>Company Name</th>
                                                <th>Email</th>
                                                <th>Address</th>
                                                <th>Website</th>
                                                <th>Phone</th>
                                                <th>Other Phone Number</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <td>
                                                    <div
                                                        fxLayout="row"
                                                        fxLayoutAlign="start center"
                                                    >
                                                            <span
                                                                class="company text-truncate"
                                                            >
                                                                {{
                                                                project
                                                                    .client
                                                                    .companyName
                                                                }}
                                                            </span>
                                                    </div>
                                                </td>
                                                <td>
                                                        <span
                                                            class="email text-truncate"
                                                        >
                                                            {{
                                                            project.client
                                                                .email
                                                            }}
                                                        </span>
                                                </td>
                                                <td>
                                                        <span
                                                            class="address text-truncate"
                                                        >
                                                            {{
                                                            project.client
                                                                .address
                                                            }}
                                                        </span>
                                                </td>
                                                <td>
                                                        <span
                                                            class="address text-truncate"
                                                        >
                                                            {{
                                                            project.client
                                                                .website
                                                            }}
                                                        </span>
                                                </td>
                                                <td>
                                                        <span
                                                            class="phone text-truncate"
                                                        >
                                                            {{
                                                            project.client
                                                                .phoneNumber
                                                            }}
                                                        </span>
                                                </td>
                                                <td>
                                                        <span
                                                            class="phone text-truncate"
                                                        >
                                                            {{
                                                            project.client
                                                                .secondPhoneNumber
                                                            }}
                                                        </span>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- END OF CLIENT DATA-->

                                <!-- PAYMENTS START-->
                                <div class="section pb-48">
                                    <div
                                        class="pb-16"
                                        fxLayout="row"
                                        fxLayoutAlign="start center"
                                    >
                                        <mat-icon
                                            class="m-0 mr-16 secondary-text"
                                        >
                                            attach_money
                                        </mat-icon>
                                        <div class="h2 secondary-text">
                                            Previous Invoices
                                        </div>
                                    </div>

                                    <table class="simple">
                                        <thead>
                                        <tr>
                                            <th>Invoice Number</th>
                                            <th>Payment Method</th>
                                            <th>Amount</th>
                                            <th>Date</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr *ngFor="let invoice of project.invoices">
                                            <td>
                                                    <span
                                                        class="address text-truncate"
                                                    >
                                                        {{
                                                        invoice.invoiceNumber
                                                        }}
                                                    </span>
                                            </td>
                                            <td>
                                                    <span
                                                        class="address text-truncate"
                                                    >
                                                        Cash
                                                    </span>
                                            </td>
                                            <td>
                                                    <span
                                                        class="address text-truncate"
                                                    >
                                                        {{ invoice.totalDue }}
                                                    </span>
                                            </td>
                                            <td>
                                                    <span class="text-truncate">
                                                        {{
                                                        invoice.invoiceDate
                                                            | date : "mediumDate"
                                                        }}
                                                    </span>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <!-- PAYMENTS END -->
                                <div>

                                    <div
                                        class="pb-16"
                                        fxLayout="row"
                                        fxLayoutAlign="start center"
                                    >
                                        <mat-icon
                                            class="m-0 mr-16 secondary-text"
                                        >
                                            account_circle
                                        </mat-icon>
                                        <div class="h2 secondary-text">
                                            Remaining Payment : {{project.remainingPayment}}
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div fxLayout="row" fxLayoutAlign="center center">
                                <button
                                    mat-raised-button
                                    matStepperNext
                                    type="button"
                                    color="accent"
                                    (click)="getServices()"
                                >
                                    Next
                                </button>
                            </div>
                        </form>
                    </mat-step>


                    <mat-step [stepControl]="servicesForm">
                        <form fxLayout="column" [formGroup]="servicesForm">
                            <ng-template matStepLabel>Services</ng-template>

                            <mat-form-field appearance="outline" fxFlex="1 1">
                                <mat-label>Services</mat-label>
                                <mat-select
                                    formControlName="service"
                                    (selectionChange)="
                                    addService($event);
                                    servicesTable.renderRows()
                                "
                                >
                                    <mat-option
                                        *ngFor="let service of services"
                                        [value]="service.serviceName"
                                    >{{ service.serviceName }}
                                    </mat-option>
                                </mat-select>
                                <mat-icon matSuffix class="secondary-text"
                                >outlined_flag
                                </mat-icon>
                                <mat-error
                                >At least one service is required!
                                </mat-error>
                            </mat-form-field>

                            <div
                                *ngIf="showServicesForm"
                                fxFlex="1 0 auto"
                                fxLayout="row"
                            >
                                <mat-label>Services</mat-label>

                                <!-- CONTENT CARD -->
                                <div class="content-card">
                                    <mat-table
                                        class="services-table"
                                        #servicesTable
                                        [dataSource]="this.invoiceServices"
                                        matSort
                                        fusePerfectScrollbar
                                    >
                                        <!-- Service Name Column -->
                                        <ng-container matColumnDef="serviceName">
                                            <mat-header-cell
                                                *matHeaderCellDef
                                                mat-sort-header
                                                fxHide
                                                fxShow.gt-sm
                                            >Service Name
                                            </mat-header-cell>
                                            <mat-cell
                                                *matCellDef="let service"
                                                fxHide
                                                fxShow.gt-sm
                                            >
                                                <p class="text-truncate">
                                                    {{ service.serviceName }}
                                                </p>
                                            </mat-cell>
                                        </ng-container>

                                        <!-- Service Description Column -->
                                        <ng-container
                                            matColumnDef="serviceDescription"
                                        >
                                            <mat-header-cell
                                                *matHeaderCellDef
                                                mat-sort-header
                                            >
                                                Tax Rate
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let service">
                                                <p class="text-truncate">
                                                    {{ service.taxRate }}
                                                </p>
                                            </mat-cell>
                                        </ng-container>

                                        <!-- Service Total Price Column -->
                                        <ng-container matColumnDef="price">
                                            <mat-header-cell
                                                *matHeaderCellDef
                                                mat-sort-header
                                                fxHide
                                                fxShow.gt-md
                                            >Total Price
                                            </mat-header-cell>
                                            <mat-cell
                                                *matCellDef="let service"
                                                fxHide
                                                fxShow.gt-md
                                            >
                                                <p
                                                    class="total-price text-truncate"
                                                >
                                                    {{
                                                    service.price
                                                        | currency
                                                        : "USD"
                                                            : "symbol"
                                                    }}
                                                </p>
                                            </mat-cell>
                                        </ng-container>

                                        <mat-header-row
                                            *matHeaderRowDef="
                                            displayedColumns;
                                            sticky: true
                                        "
                                        ></mat-header-row>

                                        <mat-row
                                            *matRowDef="
                                            let service;
                                            columns: displayedColumns
                                        "
                                            class="service"
                                            matRipple
                                            [routerLink]="
                                            '/main/services/' + service.id
                                        "
                                        >
                                        </mat-row>
                                    </mat-table>
                                </div>
                            </div>

                            <div fxLayout="row" fxLayoutAlign="center center">
                                <button
                                    class="mr-8"
                                    mat-raised-button
                                    matStepperPrevious
                                    type="button"
                                    color="accent"
                                >
                                    Previous
                                </button>
                                <button
                                    mat-raised-button
                                    matStepperNext
                                    type="button"
                                    color="accent"
                                    (click)="getTotalDue()"
                                >
                                    Next
                                </button>
                            </div>
                        </form>
                    </mat-step>

                    <mat-step [stepControl]="invoicesForm">
                        <form fxLayout="column" [formGroup]="invoicesForm">
                            <ng-template matStepLabel>Invoice Details</ng-template>

                            <div fxFlex="1 0 auto" fxLayout="column">
                                <mat-form-field appearance="outline" fxFlex="100">
                                    <mat-label>Invoice Type</mat-label>
                                    <mat-select formControlName="type">
                                        <mat-option value="DEVELOPMENT">
                                            Development
                                        </mat-option>
                                        <mat-option value="CR">
                                            Change Request
                                        </mat-option>
                                        <mat-option value="SUPPORT">
                                            Support
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="secondary-text"
                                    >outlined_flag
                                    </mat-icon>
                                </mat-form-field>

                                <mat-form-field appearance="outline" fxFlex="100">
                                    <mat-label>Total Due</mat-label>
                                    <input
                                        matInput
                                        formControlName="totalDue"
                                        required
                                    />
                                    <mat-error>Total Due is missing!</mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="outline" fxFlex="100">
                                    <mat-label>description</mat-label>
                                    <input
                                        matInput
                                        #postalCode2
                                        formControlName="description"
                                        required
                                    />
                                </mat-form-field>

                            </div>

                            <div fxLayout="row" fxLayoutAlign="center center">
                                <button
                                    class="mr-8"
                                    mat-raised-button
                                    matStepperPrevious
                                    type="button"
                                    color="accent"
                                >
                                    Previous
                                </button>
                                <button
                                    mat-raised-button
                                    matStepperNext
                                    type="button"
                                    color="accent"
                                >
                                    Next
                                </button>
                            </div>
                        </form>
                    </mat-step>

                    <mat-step>
                        <ng-template matStepLabel>Done</ng-template>

                        <div
                            class="h2 m-16"
                            fxLayout="row"
                            fxLayoutAlign="center center"
                        >
                            Review Your Invoice details
                        </div>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button
                                class="mr-8"
                                mat-raised-button
                                matStepperPrevious
                                type="button"
                                color="accent"
                            >
                                Previous
                            </button>
                            <button
                                mat-raised-button
                                type="button"
                                color="accent"
                                (click)="finishForm()"
                            >
                                Finish
                            </button>
                        </div>
                    </mat-step>
                </mat-horizontal-stepper>
                <!-- / HORIZONTAL STEPPER EXAMPLE -->
            </div>
        </div>
        <!-- / CONTENT -->
    </div>
</div>
