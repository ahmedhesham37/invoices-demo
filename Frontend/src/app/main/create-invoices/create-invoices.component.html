<div id="forms" class="page-layout simple fullwidth" fxLayout="column">
    <!-- HEADER -->
    <div
        class="header accent p-24 h-160"
        fxLayout="row"
        fxLayoutAlign="start center"
    >
        <div fxLayout="column" fxLayoutAlign="center start">
            <div fxLayout="row" fxLayoutAlign="start center">
                <mat-icon class="secondary-text s-18">home</mat-icon>
                <mat-icon class="secondary-text s-16">chevron_right</mat-icon>
                <span class="secondary-text">Invoices</span>
            </div>
            <div class="h1 mt-16">Create an Invoice</div>
        </div>
    </div>
    <!-- / HEADER -->

    <!-- CONTENT -->
    <div class="content p-24">
        <div class="horizontal-stepper-wrapper">
            <mat-horizontal-stepper class="mat-elevation-z4" [linear]="true">
                <mat-step [stepControl]="FormStep1">
                    <form fxLayout="column" [formGroup]="FormStep1">
                        <ng-template matStepLabel>Client</ng-template>

                        <div class="tab-content p-24">
                            <mat-form-field appearance="outline" fxFlex="1 1">
                                <mat-label>Company Name</mat-label>
                                <mat-select
                                    formControlName="client"
                                    (valueChange)="populateClient($event)"
                                >
                                    <mat-option
                                        *ngFor="let client of savedClients"
                                        [value]="client.companyName"
                                        >{{ client.companyName }}
                                    </mat-option>
                                </mat-select>
                                <mat-icon matSuffix class="secondary-text"
                                    >outlined_flag
                                </mat-icon>
                                <mat-error>Company is required!</mat-error>
                            </mat-form-field>

                            <button
                                mat-raised-button
                                matStepperNext
                                style="margin: 10px"
                                color="accent"
                                type="button"
                                (click)="showClientForm = !showClientForm"
                            >
                                <span>NEW CLIENT</span>
                            </button>
                        </div>

                        <div
                            class="tab-content p-24"
                            fxFlex="1 0 auto"
                            fxLayout="column"
                            *ngIf="showClientForm"
                        >
                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Company</mat-label>
                                <input
                                    matInput
                                    formControlName="companyName"
                                    required
                                />
                                <mat-error>Company Name is required!</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Company Address</mat-label>
                                <input
                                    matInput
                                    formControlName="address"
                                    required
                                />
                                <mat-error
                                    >Company Address is required!
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Company Website</mat-label>
                                <input
                                    matInput
                                    formControlName="website"
                                    required
                                />
                                <mat-error
                                    >Company Website is required!
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Company Email</mat-label>
                                <input
                                    matInput
                                    formControlName="email"
                                    required
                                />
                                <mat-error
                                    >Company Email is required!
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Company Phone Number</mat-label>
                                <input
                                    matInput
                                    formControlName="phoneNumber"
                                    required
                                />
                                <mat-error
                                    >Company Phone Number is required!
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Other Phone Number</mat-label>
                                <input
                                    matInput
                                    formControlName="secondPhoneNumber"
                                />
                            </mat-form-field>
                        </div>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button
                                mat-raised-button
                                matStepperNext
                                type="button"
                                color="accent"
                            >
                                Next
                            </button>
                        </div>
                    </form>
                </mat-step>

                <mat-step [stepControl]="FormStep2">
                    <form fxLayout="column" [formGroup]="FormStep2">
                        <ng-template matStepLabel>Services</ng-template>

                        <mat-form-field appearance="outline" fxFlex="1 1">
                            <mat-label>Services</mat-label>
                            <mat-select
                                formControlName="service"
                                (selectionChange)="
                                    addService($event);
                                    servicesTable.renderRows()
                                "
                            >
                                <mat-option
                                    *ngFor="let service of services"
                                    [value]="service.serviceName"
                                    >{{ service.serviceName }}
                                </mat-option>
                            </mat-select>
                            <mat-icon matSuffix class="secondary-text"
                                >outlined_flag
                            </mat-icon>
                            <mat-error
                                >At least one service is required!
                            </mat-error>
                        </mat-form-field>

                        <div
                            *ngIf="showServicesForm"
                            fxFlex="1 0 auto"
                            fxLayout="row"
                        >
                            <mat-label>Services</mat-label>

                            <!-- CONTENT CARD -->
                            <div class="content-card">
                                <mat-table
                                    class="services-table"
                                    #servicesTable
                                    [dataSource]="this.invoiceServices"
                                    matSort
                                    fusePerfectScrollbar
                                >
                                    <!-- Service Name Column -->
                                    <ng-container matColumnDef="serviceName">
                                        <mat-header-cell
                                            *matHeaderCellDef
                                            mat-sort-header
                                            fxHide
                                            fxShow.gt-sm
                                            >Service Name
                                        </mat-header-cell>
                                        <mat-cell
                                            *matCellDef="let service"
                                            fxHide
                                            fxShow.gt-sm
                                        >
                                            <p class="text-truncate">
                                                {{ service.serviceName }}
                                            </p>
                                        </mat-cell>
                                    </ng-container>

                                    <!-- Service Description Column -->
                                    <ng-container
                                        matColumnDef="serviceDescription"
                                    >
                                        <mat-header-cell
                                            *matHeaderCellDef
                                            mat-sort-header
                                        >
                                            Tax Rate
                                        </mat-header-cell>
                                        <mat-cell *matCellDef="let service">
                                            <p class="text-truncate">
                                                {{ service.taxRate }}
                                            </p>
                                        </mat-cell>
                                    </ng-container>

                                    <!-- Service Total Price Column -->
                                    <ng-container matColumnDef="price">
                                        <mat-header-cell
                                            *matHeaderCellDef
                                            mat-sort-header
                                            fxHide
                                            fxShow.gt-md
                                            >Total Price
                                        </mat-header-cell>
                                        <mat-cell
                                            *matCellDef="let service"
                                            fxHide
                                            fxShow.gt-md
                                        >
                                            <p
                                                class="total-price text-truncate"
                                            >
                                                {{
                                                    service.price
                                                        | currency
                                                            : "USD"
                                                            : "symbol"
                                                }}
                                            </p>
                                        </mat-cell>
                                    </ng-container>

                                    <mat-header-row
                                        *matHeaderRowDef="
                                            displayedColumns;
                                            sticky: true
                                        "
                                    ></mat-header-row>

                                    <mat-row
                                        *matRowDef="
                                            let service;
                                            columns: displayedColumns
                                        "
                                        class="service"
                                        matRipple
                                        [routerLink]="
                                            '/main/services/' + service.id
                                        "
                                    >
                                    </mat-row>
                                </mat-table>
                            </div>
                            <!-- / CONTENT CARD -->

                            <!--                            <mat-error-->
                            <!--                                >At least one service is required!</mat-error-->
                            <!--                            >-->
                        </div>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button
                                class="mr-8"
                                mat-raised-button
                                matStepperPrevious
                                type="button"
                                color="accent"
                            >
                                Previous
                            </button>
                            <button
                                mat-raised-button
                                matStepperNext
                                type="button"
                                color="accent"
                            >
                                Next
                            </button>
                        </div>
                    </form>
                </mat-step>

                <mat-step [stepControl]="FormStep3">
                    <form fxLayout="column" [formGroup]="FormStep3">
                        <ng-template matStepLabel>Invoice Details</ng-template>

                        <div fxFlex="1 0 auto" fxLayout="column">
                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Invoice Number</mat-label>
                                <input
                                    matInput
                                    formControlName="invoiceNumber"
                                    required
                                />
                                <mat-error
                                    >Invoice Number is required!
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Invoice Type</mat-label>
                                <mat-select formControlName="type">
                                    <mat-option value="DEVELOPMENT">
                                        Development
                                    </mat-option>
                                    <mat-option value="CR">
                                        Change Request
                                    </mat-option>
                                    <mat-option value="SUPPORT">
                                        Support
                                    </mat-option>
                                </mat-select>
                                <mat-icon matSuffix class="secondary-text"
                                    >outlined_flag
                                </mat-icon>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>Total Due</mat-label>
                                <input
                                    matInput
                                    formControlName="totalDue"
                                    required
                                />
                                <mat-error>Total Due is missing!</mat-error>
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="100">
                                <mat-label>description</mat-label>
                                <input
                                    matInput
                                    #postalCode2
                                    formControlName="description"
                                    required
                                />
                                <mat-error>Postal Code is required!</mat-error>
                            </mat-form-field>

                            <mat-form-field
                                appearance="outline"
                                class="ml-sm-12"
                                fxFlex
                            >
                                <mat-label>Invoice Date</mat-label>
                                <input
                                    matInput
                                    #invoiceDate
                                    formControlName="invoiceDate"
                                />
                            </mat-form-field>

                        </div>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button
                                class="mr-8"
                                mat-raised-button
                                matStepperPrevious
                                type="button"
                                color="accent"
                            >
                                Previous
                            </button>
                            <button
                                mat-raised-button
                                matStepperNext
                                type="button"
                                color="accent"
                            >
                                Next
                            </button>
                        </div>
                    </form>
                </mat-step>

                <mat-step>
                    <ng-template matStepLabel>Done</ng-template>

                    <div
                        class="h2 m-16"
                        fxLayout="row"
                        fxLayoutAlign="center center"
                    >
                        Review Your Invoice details
                    </div>

                    <div fxLayout="row" fxLayoutAlign="center center">
                        <button
                            class="mr-8"
                            mat-raised-button
                            matStepperPrevious
                            type="button"
                            color="accent"
                        >
                            Previous
                        </button>
                        <button
                            mat-raised-button
                            type="button"
                            color="accent"
                            (click)="finishForm()"
                        >
                            Finish
                        </button>
                    </div>
                </mat-step>
            </mat-horizontal-stepper>
            <!-- / HORIZONTAL STEPPER EXAMPLE -->
        </div>
    </div>
    <!-- / CONTENT -->
</div>
