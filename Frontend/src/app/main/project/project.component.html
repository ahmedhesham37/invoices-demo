<div id="project" class="page-layout carded fullwidth inner-scroll">
    <!-- TOP BACKGROUND -->
    <div class="top-bg accent"></div>
    <!-- / TOP BACKGROUND -->

    <!-- CENTER -->
    <div class="center">
        <!-- HEADER -->
        <div
            class="header accent"
            fxLayout="row"
            fxLayoutAlign="space-between center"
        >
            <!-- APP TITLE -->
            <div fxLayout="row" fxLayoutAlign="start center">
                <button
                    mat-icon-button
                    class="mr-0 mr-sm-16"
                    [routerLink]="'/main/projects'"
                >
                    <mat-icon>arrow_back</mat-icon>
                </button>

                <div
                    fxLayout="column"
                    fxLayoutAlign="start start"
                    [@animate]="{
                        value: '*',
                        params: { delay: '100ms', x: '-25px' }
                    }"
                >
                    <div class="h2" *ngIf="pageType === 'edit'">
                        {{ project.projectName }}
                    </div>
                    <div class="h2" *ngIf="pageType === 'new'">New Project</div>
                    <div class="subtitle secondary-text">
                        <span>Project Details</span>
                    </div>
                </div>
            </div>
            <!-- / APP TITLE -->

            <button
                mat-raised-button
                class="add-project-button"
                [disabled]="projectForm.invalid"
                *ngIf="pageType === 'new'"
                (click)="addProject()"
            >
                <span>ADD</span>
            </button>

            <button
                mat-raised-button
                class="save-project-button"
                [disabled]="projectForm.invalid || projectForm.pristine"
                *ngIf="pageType === 'edit'"
                (click)="saveProject()"
            >
                <span>SAVE</span>
            </button>
        </div>
        <!-- / HEADER -->

        <!-- CONTENT CARD -->
        <div class="content-card">
            <!-- CONTENT -->
            <div class="content">


                <mat-tab-group>
                        <mat-tab label="Project Info">
                            <form
                                name="projectForm"
                                [formGroup]="projectForm"
                                class="project w-100-p"
                                fxLayout="column"
                                fxFlex
                            >
                            <div class="tab-content p-24" fusePerfectScrollbar>
                                <mat-form-field
                                    appearance="outline"
                                    floatLabel="always"
                                    class="w-100-p"
                                >
                                    <mat-label>Project Name</mat-label>
                                    <input
                                        matInput
                                        placeholder="Project Name"
                                        name="projectName"
                                        formControlName="projectName"
                                        required
                                    />
                                </mat-form-field>

                                <mat-form-field
                                    appearance="outline"
                                    floatLabel="always"
                                    class="w-100-p"
                                >
                                    <mat-label>Project Number</mat-label>
                                    <textarea
                                        matInput
                                        placeholder="Project Number"
                                        name="projectNumber"
                                        formControlName="projectNumber"
                                    >
                                    </textarea>
                                </mat-form-field>

                                <mat-form-field
                                    appearance="outline"
                                    floatLabel="always"
                                    class="w-100-p"
                                >
                                    <mat-label>Project Status</mat-label>
                                    <textarea
                                        matInput
                                        placeholder="Project Status"
                                        name="status"
                                        formControlName="status"
                                    >
                                    </textarea>
                                </mat-form-field>

                                <mat-form-field
                                    appearance="outline"
                                    floatLabel="always"
                                    class="w-100-p"
                                >
                                    <mat-label>Remaining Payments</mat-label>
                                    <textarea
                                        matInput
                                        placeholder="Remaining Payments"
                                        name="remainingPayment"
                                        formControlName="remainingPayment"
                                    >
                                    </textarea>
                                </mat-form-field>

                                <mat-form-field
                                    appearance="outline"
                                    floatLabel="always"
                                    class="w-100-p"
                                >
                                    <mat-label>Total Price</mat-label>
                                    <textarea
                                        matInput
                                        placeholder="Total Price"
                                        name="totalDue"
                                        formControlName="totalDue"
                                    >
                                    </textarea>
                                </mat-form-field>


                            </div>
                            </form>
                    </mat-tab>

                    <mat-tab label="Client">
                        <form name="clientForm"
                              [formGroup]="clientForm"
                              class="project w-100-p"
                              fxLayout="column"
                              fxFlex>

                            <div class="tab-content p-24">
                                <mat-form-field appearance="outline" fxFlex="1 1">
                                    <mat-label>Company Name</mat-label>
                                    <mat-select
                                        formControlName="client"
                                        (valueChange)="populateClient($event)"
                                    >
                                        <mat-option
                                            *ngFor="let client of savedClients"
                                            [value]="client.companyName"
                                        >{{ client.companyName }}
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="secondary-text"
                                    >outlined_flag
                                    </mat-icon>
                                    <mat-error>Company is required!</mat-error>
                                </mat-form-field>

                                <button
                                    mat-raised-button
                                    style="margin: 10px"
                                    color="accent"
                                    type="button"
                                    (click)="showClientForm = !showClientForm"
                                >
                                    <span>NEW CLIENT</span>
                                </button>
                            </div>

                            <div
                                class="tab-content p-24"
                                fxFlex="1 0 auto"
                                fxLayout="column"
                                *ngIf="showClientForm"
                            >
                                <mat-form-field appearance="outline" fxFlex="100">
                                    <mat-label>Company</mat-label>
                                    <input
                                        matInput
                                        formControlName="companyName"
                                        required
                                    />
                                    <mat-error>Company Name is required!</mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="outline" fxFlex="100">
                                    <mat-label>Company Address</mat-label>
                                    <input
                                        matInput
                                        formControlName="address"
                                        required
                                    />
                                    <mat-error
                                    >Company Address is required!
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="outline" fxFlex="100">
                                    <mat-label>Company Website</mat-label>
                                    <input
                                        matInput
                                        formControlName="website"
                                        required
                                    />
                                    <mat-error
                                    >Company Website is required!
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="outline" fxFlex="100">
                                    <mat-label>Company Email</mat-label>
                                    <input
                                        matInput
                                        formControlName="email"
                                        required
                                    />
                                    <mat-error
                                    >Company Email is required!
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="outline" fxFlex="100">
                                    <mat-label>Company Phone Number</mat-label>
                                    <input
                                        matInput
                                        formControlName="phoneNumber"
                                        required
                                    />
                                    <mat-error
                                    >Company Phone Number is required!
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="outline" fxFlex="100">
                                    <mat-label>Other Phone Number</mat-label>
                                    <input
                                        matInput
                                        formControlName="secondPhoneNumber"
                                    />
                                </mat-form-field>
                            </div>
                        </form>
                    </mat-tab>

                    <mat-tab label="Services">
                        <form name="servicesForm"
                              [formGroup]="servicesForm"
                              class="project w-100-p"
                              fxLayout="column"
                              fxFlex>
                                <mat-form-field appearance="outline" fxFlex="1 1">
                                    <mat-label>Services</mat-label>
                                    <mat-select
                                        formControlName="service"
                                        (selectionChange)="
                                    addServiceToProject($event);
                                    servicesTable.renderRows()
                                "
                                    >
                                        <mat-option
                                            *ngFor="let service of savedServices"
                                            [value]="service.serviceName"
                                        >{{ service.serviceName }}
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="secondary-text"
                                    >outlined_flag
                                    </mat-icon>
                                    <mat-error
                                    >At least one service is required!
                                    </mat-error>
                                </mat-form-field>

                                <div
                                    *ngIf="showServicesForm"
                                    fxFlex="1 0 auto"
                                    fxLayout="row"
                                >
                                    <mat-label>Services</mat-label>

                                    <!-- CONTENT CARD -->
                                    <div class="content-card">
                                        <mat-table
                                            class="services-table"
                                            #servicesTable
                                            [dataSource]="this.projectServices"
                                            matSort
                                            fusePerfectScrollbar
                                        >
                                            <!-- Service Name Column -->
                                            <ng-container matColumnDef="serviceName">
                                                <mat-header-cell
                                                    *matHeaderCellDef
                                                    mat-sort-header
                                                    fxHide
                                                    fxShow.gt-sm
                                                >Service Name
                                                </mat-header-cell>
                                                <mat-cell
                                                    *matCellDef="let service"
                                                    fxHide
                                                    fxShow.gt-sm
                                                >
                                                    <p class="text-truncate">
                                                        {{ service.serviceName }}
                                                    </p>
                                                </mat-cell>
                                            </ng-container>

                                            <!-- Service Description Column -->
                                            <ng-container
                                                matColumnDef="serviceDescription"
                                            >
                                                <mat-header-cell
                                                    *matHeaderCellDef
                                                    mat-sort-header
                                                >
                                                    Tax Rate
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let service">
                                                    <p class="text-truncate">
                                                        {{ service.taxRate }}
                                                    </p>
                                                </mat-cell>
                                            </ng-container>

                                            <!-- Service Total Price Column -->
                                            <ng-container matColumnDef="price">
                                                <mat-header-cell
                                                    *matHeaderCellDef
                                                    mat-sort-header
                                                    fxHide
                                                    fxShow.gt-md
                                                >Total Price
                                                </mat-header-cell>
                                                <mat-cell
                                                    *matCellDef="let service"
                                                    fxHide
                                                    fxShow.gt-md
                                                >
                                                    <p
                                                        class="total-price text-truncate"
                                                    >
                                                        {{
                                                        service.price
                                                            | currency
                                                            : "USD"
                                                                : "symbol"
                                                        }}
                                                    </p>
                                                </mat-cell>
                                            </ng-container>

                                            <mat-header-row
                                                *matHeaderRowDef="
                                            displayedColumns;
                                            sticky: true
                                        "
                                            ></mat-header-row>

                                            <mat-row
                                                *matRowDef="
                                            let service;
                                            columns: displayedColumns
                                        "
                                                class="service"
                                                matRipple
                                                [routerLink]="
                                            '/main/services/' + service.id
                                        "
                                            >
                                            </mat-row>
                                        </mat-table>
                                    </div>
                                </div>

                        </form>

                    </mat-tab>

<!--                    <mat-tab label="Invoices">-->
<!--                        <form name="invoicesForm"-->
<!--                              [formGroup]="invoicesForm"-->
<!--                              class="project w-100-p"-->
<!--                              fxLayout="column"-->
<!--                              fxFlex>-->

<!--                        </form>-->
<!--                    </mat-tab>-->

                </mat-tab-group>

            </div>
            <!-- / CONTENT -->
        </div>
        <!-- / CONTENT CARD -->
    </div>
    <!-- / CENTER -->
</div>
